
# SQL生成器规则说明

## 1. 项目功能简介

本系统是一个基于自然语言生成 SQL 查询语句的工具，用户通过上传表结构文件（CSV 格式）并输入查询意图，即可自动生成标准 SQL 查询语句，支持单表或多表查询。

## 2. 表结构输入说明

用户上传的 CSV 文件包含表结构定义，一般包括以下字段：

| 字段 | 说明 |
|------|------|
| 字段名（Field） | 表中字段的名称，如 `id`, `name` |
| 类型（Type） | 字段类型，如 `INT`, `VARCHAR`, `DATE` |
| 描述（Comment） | 可选，用于说明字段含义，如“用户ID”、“注册时间”等 |

系统会将该文件内容解析成结构化格式，例如：

```
表名：users
字段：
- id: INT，用户唯一标识
- name: VARCHAR，用户名
- age: INT，用户年龄
- created_at: DATETIME，注册时间
```

## 3. 用户查询意图输入方式

用户可以输入自由形式的自然语言查询，例如：

- “查询所有年龄大于30岁的用户姓名和年龄”
- “按照注册时间倒序查询最近注册的10个用户”
- “统计不同年龄段的用户数量，按年龄分组”

## 4. SQL 生成规则

根据表结构和查询意图，生成 SQL 时遵循以下规则：

- **字段名准确匹配**：字段名称以表结构为准，避免拼写错误
- **语义映射**：如“最近注册”表示按 `created_at` 排序；“年龄大于30”对应 `WHERE age > 30`
- **字段筛选**：尽量只选择被请求的字段，避免使用 `SELECT *`
- **排序语义**：常见关键词 “最早/最新”、“升序/降序” 需对应 `ORDER BY`
- **分组聚合**：如“每个年龄段人数”，应使用 `GROUP BY age` 与 `COUNT(*)`

## 5. 示例

**输入表结构：**

```
表名：users
字段：
- id: INT，主键
- name: VARCHAR，用户名
- age: INT，年龄
- created_at: DATETIME，注册时间
```

**用户需求：**

```
查询所有年龄大于30岁的用户姓名和年龄，按年龄降序排列
```

**生成 SQL：**

```sql
SELECT name, age
FROM users
WHERE age > 30
ORDER BY age DESC;
```

## 6. 多表连接规则（可选扩展）

当上传多个表结构时，可以进行简单的 JOIN 查询。系统根据字段名推测外键关系，或由用户说明。例如：

- “查询订单表中每个用户的姓名和订单金额”
- 表结构中包含 `user_id` 和 `users.id` 可建立关联

生成 SQL：

```sql
SELECT u.name, o.amount
FROM orders o
JOIN users u ON o.user_id = u.id;
```

## 7. 模型输出格式要求

- 仅输出标准 SQL 语句，不包含中文解释或代码块符号
- 支持 ANSI SQL，避免使用特定数据库方言（如 T-SQL、PL/pgSQL）除非用户特别说明
- SQL 语句应可直接执行
